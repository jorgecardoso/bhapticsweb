/*! For license information please see aframe-bhaptics-component.min.js.LICENSE.txt */
!function(e,n){if("object"==typeof exports&&"object"==typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var t=n();for(var r in t)("object"==typeof exports?exports:e)[r]=t[r]}}(this,(()=>(()=>{var __webpack_modules__={237:()=>{if("undefined"==typeof AFRAME)throw new Error('Component "bHaptics" attempted to register before AFRAME was available.');AFRAME.registerSystem("bhaptics",{schema:{appname:{type:"string",default:"myApp"},middlewareaddress:{type:"string",default:""},servicediscoveryaddress:{type:"string",default:"https://hmd-link-service.glitch.me"},displayconnectionerror:{type:"boolean",default:!0},files:{type:"array"}},init:function(){console.log("Initing system: bHaptics");let e=this;this.player=null,this.middlewarePromise=null,""==this.data.middlewareaddress?this.middlewarePromise=this._findMiddleware(this.data.servicediscoveryaddress):this.middlewarePromise=Promise.resolve(this.data.middlewareaddress),this.middlewarePromise.then((()=>{console.log("Files to register in bHaptics: "),console.log(this.data.files)})),this.middlewarePromise.then((n=>{fetch(n.replace("wss","https")).then((function(e){})).catch((function(t){if(t instanceof TypeError&&e.data.displayconnectionerror){let e=document.querySelector("#connectionerror");e.querySelector("a").href=n.replace("wss","https"),e.style.display="initial",console.log("Showing connection error to user")}})),console.log(n),e.player=new BhapticsPlayer,e.player.initialize(e.data.appname,e.data.appname,n+"/v2/feedbacks?"),e.player.socket.connect(),console.log("Adding listaner:");let t=!1;e.player.socket.addListener((n=>{t||(console.log("listened: ",n),t=!0,"Connected"===n.status&&e.data.files&&e.data.files.forEach((n=>{console.log("Registering ",n),fetch(n).then((e=>e.text())).then((r=>{let o=e.player.registerFile(n,r);0!==o&&(t=!1),console.log("Registered ",n," with error code: ",o)}))})))})),e.player.submitDot("key","VestFront",[{index:10,intensity:100}],20)})).catch((e=>{console.error("Updating component: ",e)}))},pause:function(){let e=this;this._registeredEventsPromise.then((function([n,t,r]){return this._socket.close(),e.stop(n,t,r)})).then((function([n,t,r]){e._ready=!1})).catch((e=>{console.error(e)}))},_findMiddleware:function(e){return new Promise((function(n,t){let r=2;console.info("Using Service Discovery: ",e),setTimeout((function o(){fetch(e).then((function(e){return e.json()})).then((function(e){e.bhapticsmiddleware?(console.info("bHaptics Middleware found through service discovery: ",e.bhapticsmiddleware),console.log(e.bhapticsmiddleware.address),n(e.bhapticsmiddleware.address)):(r=Math.min(2*r,30),console.warn("bHaptics middleware not found through service discovery. Trying again in ",r," seconds."),setTimeout(o,1e3*r))})).catch((function(e){console.log(e),t(e)}))}),r)}))}}),AFRAME.registerComponent("bhaptics",{schema:{on:{type:"string",default:"click"},type:{type:"string",default:"dot"},position:{type:"string",default:"VestFront"},points:{type:"array",default:[1]},x:{type:"array",default:[0]},y:{type:"array",default:[0]},intensities:{type:"array",default:[100]},duration:{type:"int",default:500},file:{type:"string"}},multiple:!1,init:function(){let e=this;this.el.addEventListener(this.data.on,(function(){let n=null,t=e.system.player;if(t)switch(e.data.type){case"dot":console.log(e.data.points),n=e.data.points.map((function(n,t){return{index:n,intensity:e.data.intensities[t]}})),console.log(n),t.submitDot("dot",e.data.position,n,e.data.duration);break;case"path":console.log(e.data.x),n=e.data.x.map((function(n,t){return{x:Number(n),y:Number(e.data.y[t]),intensity:Number(e.data.intensities[t])}})),console.log(n),t.submitPath("mypath",e.data.position,n,e.data.duration);break;case"file":console.log(e.data.file),t.submitRegistered(e.data.file)}}))},remove:function(){},tick:function(e){},play:function(){}})},301:function(module){var factory;factory=()=>(()=>{"use strict";var __webpack_modules__={"./src/BhapticsPlayer.ts":function(__unused_webpack_module,exports,__webpack_require__){eval("\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nvar PlayerSocket_1 = __importDefault(__webpack_require__(/*! ./PlayerSocket */ \"./src/PlayerSocket.ts\"));\nvar Interfaces_1 = __webpack_require__(/*! ./models/Interfaces */ \"./src/models/Interfaces.ts\");\nvar ErrorCode_1 = __importDefault(__webpack_require__(/*! ./models/ErrorCode */ \"./src/models/ErrorCode.ts\"));\nvar BhapticsPlayer = /** @class */ (function () {\n    function BhapticsPlayer() {\n        var _this = this;\n        this.registeredKeys = [];\n        this.addListener = function (func) {\n            if (!_this.socket) {\n                console.log('BhapticsSdk not initialized');\n                return;\n            }\n            _this.socket.addListener(func);\n        };\n        this.initialize = function (appId, appName, url) {\n            if (appId === undefined) {\n                throw new Error('App ID is required');\n            }\n            if (appName === undefined) {\n                throw new Error('App Name is required');\n            }\n            if (_this.socket) {\n                console.log('initialize called twice');\n                return;\n            }\n            _this.socket = new PlayerSocket_1.default(appId, appName, undefined, url);\n            _this.addListener((function (msg) {\n                var _a;\n                if ((_a = msg.message) === null || _a === void 0 ? void 0 : _a.RegisteredKeys) {\n                    _this.registeredKeys = msg.message.RegisteredKeys;\n                }\n            }));\n        };\n        this.turnOff = function (key) {\n            var request = {\n                Submit: [{\n                        Type: 'turnOff',\n                        Key: key,\n                    }],\n            };\n            if (!_this.socket) {\n                return ErrorCode_1.default.MESSAGE_NOT_INITIALIZED;\n            }\n            return _this.socket.send(JSON.stringify(request));\n        };\n        this.turnOffAll = function () {\n            var request = {\n                Submit: [{\n                        Type: 'turnOffAll',\n                    }],\n            };\n            if (!_this.socket) {\n                return ErrorCode_1.default.MESSAGE_NOT_INITIALIZED;\n            }\n            return _this.socket.send(JSON.stringify(request));\n        };\n        this.submitDot = function (key, pos, dotPoints, durationMillis) {\n            if (!_this.socket) {\n                return ErrorCode_1.default.MESSAGE_NOT_INITIALIZED;\n            }\n            if (durationMillis < 20 || durationMillis > 100000) {\n                return ErrorCode_1.default.MESSAGE_INVALID_DURATION_MILLIS;\n            }\n            if (dotPoints === undefined) {\n                return ErrorCode_1.default.MESSAGE_INVALID;\n            }\n            for (var i = 0; i < dotPoints.length; i++) {\n                var point = dotPoints[i];\n                switch (pos) {\n                    case Interfaces_1.PositionType.ForearmL:\n                    case Interfaces_1.PositionType.ForearmR:\n                        if (point.index < 0 || point.index >= 6) {\n                            return ErrorCode_1.default.MESSAGE_INVALID_DOT_INDEX_ARM;\n                        }\n                        break;\n                    case Interfaces_1.PositionType.Head:\n                        if (point.index < 0 || point.index >= 6) {\n                            return ErrorCode_1.default.MESSAGE_INVALID_DOT_INDEX_HEAD;\n                        }\n                        break;\n                    case Interfaces_1.PositionType.VestBack:\n                    case Interfaces_1.PositionType.VestFront:\n                        if (point.index < 0 || point.index >= 20) {\n                            return ErrorCode_1.default.MESSAGE_INVALID_DOT_INDEX_VEST;\n                        }\n                        break;\n                }\n                if (point.intensity < 0 || point.intensity > 100) {\n                    return ErrorCode_1.default.MESSAGE_INVALID_INTENSITY;\n                }\n            }\n            var request = {\n                Submit: [{\n                        Type: 'frame',\n                        Key: key,\n                        Frame: {\n                            Position: pos,\n                            PathPoints: [],\n                            DotPoints: dotPoints,\n                            DurationMillis: durationMillis,\n                        },\n                    }],\n            };\n            return _this.socket.send(JSON.stringify(request, function (_, val) {\n                return val.toFixed ? Number(val.toFixed(3)) : val;\n            }));\n        };\n        this.submitPath = function (key, pos, pathPoints, durationMillis) {\n            if (!_this.socket) {\n                return ErrorCode_1.default.MESSAGE_NOT_INITIALIZED;\n            }\n            if (isNaN(durationMillis)) {\n                return ErrorCode_1.default.MESSAGE_INVALID_DURATION_MILLIS;\n            }\n            if (durationMillis < 20 || durationMillis > 100000) {\n                return ErrorCode_1.default.MESSAGE_INVALID_DURATION_MILLIS;\n            }\n            if (pathPoints === undefined) {\n                return ErrorCode_1.default.MESSAGE_INVALID;\n            }\n            for (var i = 0; i < pathPoints.length; i++) {\n                var point = pathPoints[i];\n                if (point.x < 0 || point.x > 1) {\n                    return ErrorCode_1.default.MESSAGE_INVALID_X;\n                }\n                if (point.y < 0 || point.y > 1) {\n                    return ErrorCode_1.default.MESSAGE_INVALID_Y;\n                }\n                if (point.intensity < 0 || point.intensity > 100) {\n                    return ErrorCode_1.default.MESSAGE_INVALID_INTENSITY;\n                }\n            }\n            var request = {\n                Submit: [{\n                        Type: 'frame',\n                        Key: key,\n                        Frame: {\n                            Position: pos,\n                            PathPoints: pathPoints,\n                            DotPoints: [],\n                            DurationMillis: durationMillis,\n                        },\n                    }],\n            };\n            return _this.socket.send(JSON.stringify(request, function (_, val) {\n                return val.toFixed ? Number(val.toFixed(3)) : val;\n            }));\n        };\n        this.registerFile = function (key, json) {\n            if (!_this.socket) {\n                throw new Error('BhapticsSdk not initialized');\n            }\n            var jsonData = JSON.parse(json);\n            var project = jsonData[\"project\"];\n            var request = {\n                Register: [{\n                        Key: key,\n                        project: project,\n                    }]\n            };\n            return _this.socket.send(JSON.stringify(request));\n        };\n        this.submitRegistered = function (key) {\n            if (!_this.socket) {\n                return ErrorCode_1.default.MESSAGE_NOT_INITIALIZED;\n            }\n            if (_this.registeredKeys.find(function (v) { return v === key; }) === undefined) {\n                return ErrorCode_1.default.MESSAGE_NOT_REGISTERED_KEY;\n            }\n            var request = {\n                Submit: [{\n                        Type: 'key',\n                        Key: key,\n                    }],\n            };\n            return _this.socket.send(JSON.stringify(request));\n        };\n        this.submitRegisteredWithScaleOption = function (key, scaleOption) {\n            if (!_this.socket) {\n                return ErrorCode_1.default.MESSAGE_NOT_INITIALIZED;\n            }\n            if (_this.registeredKeys.find(function (v) { return v === key; }) === undefined) {\n                return ErrorCode_1.default.MESSAGE_NOT_REGISTERED_KEY;\n            }\n            if (scaleOption.intensity < 0.2 || scaleOption.intensity > 5) {\n                return ErrorCode_1.default.MESSAGE_INVALID_SCALE_INTENSITY_RATIO;\n            }\n            if (scaleOption.duration < 0.2 || scaleOption.duration > 5) {\n                return ErrorCode_1.default.MESSAGE_INVALID_SCALE_DURATION_RATIO;\n            }\n            var request = {\n                Submit: [{\n                        Type: 'key',\n                        Key: key,\n                        Parameters: {\n                            scaleOption: scaleOption,\n                        }\n                    }],\n            };\n            return _this.socket.send(JSON.stringify(request));\n        };\n        this.submitRegisteredWithRotationOption = function (key, rotationOption) {\n            if (!_this.socket) {\n                return ErrorCode_1.default.MESSAGE_NOT_INITIALIZED;\n            }\n            if (_this.registeredKeys.find(function (v) { return v === key; }) === undefined) {\n                return ErrorCode_1.default.MESSAGE_NOT_REGISTERED_KEY;\n            }\n            if (rotationOption.offsetAngleX < 0 || rotationOption.offsetAngleX > 360) {\n                return ErrorCode_1.default.MESSAGE_INVALID_ROTATION_X;\n            }\n            if (rotationOption.offsetY < -0.5 || rotationOption.offsetY > 0.5) {\n                return ErrorCode_1.default.MESSAGE_INVALID_ROTATION_Y;\n            }\n            var request = {\n                Submit: [{\n                        Type: 'key',\n                        Key: key,\n                        Parameters: {\n                            rotationOption: rotationOption,\n                        }\n                    }],\n            };\n            return _this.socket.send(JSON.stringify(request));\n        };\n    }\n    return BhapticsPlayer;\n}());\nexports[\"default\"] = BhapticsPlayer;\n\n\n//# sourceURL=webpack://tactJs/./src/BhapticsPlayer.ts?")},"./src/PlayerSocket.ts":function(__unused_webpack_module,exports,__webpack_require__){eval('\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { "default": mod };\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.STATUS = void 0;\nvar ErrorCode_1 = __importDefault(__webpack_require__(/*! ./models/ErrorCode */ "./src/models/ErrorCode.ts"));\nvar DEFAULT_URL = \'ws://127.0.0.1:15881/v2/feedbacks?\'; //app_id=com.bhaptics.designer2&app_name=bHaptics Designer\';\nvar STATUS;\n(function (STATUS) {\n    STATUS["CONNECTING"] = "Connecting";\n    STATUS["CONNECTED"] = "Connected";\n    STATUS["DISCONNECT"] = "Disconnected";\n})(STATUS || (exports.STATUS = STATUS = {}));\nvar DEFAULT_RETRY_CONNECT_TIME = 5000;\nvar PlayerSocket = /** @class */ (function () {\n    function PlayerSocket(appId, appName, retryConnectTime, url) {\n        if (appId === void 0) { appId = "yourAppId"; }\n        if (appName === void 0) { appName = \'yourAppName\'; }\n        if (retryConnectTime === void 0) { retryConnectTime = DEFAULT_RETRY_CONNECT_TIME; }\n        if (url === void 0) { url = DEFAULT_URL; }\n        var _this = this;\n        // eslint-disable-next-line @typescript-eslint/ban-types\n        this.handlers = [];\n        this.isTriggered = false;\n        this.addListener = function (func) {\n            _this.handlers.push(func);\n        };\n        this.emit = function (msg) {\n            _this.handlers.forEach(function (func) {\n                func(msg);\n            });\n        };\n        this.connect = function () {\n            try {\n                _this.websocketClient = new WebSocket("".concat(_this.url, "app_id=").concat(_this.appId, "&app_name=").concat(_this.appName));\n                console.log("connecting to: " + "".concat(_this.url, "app_id=").concat(_this.appId, "&app_name=").concat(_this.appName));\n            }\n            catch (e) {\n                // connection failed\n                console.log(\'PlayerSocket\', e);\n                return;\n            }\n            _this.websocketClient.onopen = function () {\n                console.log("connected");\n                _this.currentStatus = STATUS.CONNECTED;\n                _this.emit({\n                    status: _this.currentStatus,\n                    message: _this.message,\n                });\n            };\n            _this.websocketClient.onmessage = function (result) {\n                if (JSON.stringify(_this.message) === result.data) {\n                    return;\n                }\n                _this.message = JSON.parse(result.data);\n                _this.emit({\n                    status: _this.currentStatus,\n                    message: _this.message,\n                });\n            };\n            _this.websocketClient.onclose = function (_) {\n                _this.currentStatus = STATUS.DISCONNECT;\n                _this.emit({\n                    status: _this.currentStatus,\n                    message: _this.message,\n                });\n                setTimeout(function () {\n                    _this.connect();\n                }, _this.retryConnectTime);\n            };\n            _this.websocketClient.onerror = function (event) {\n                _this.currentStatus = STATUS.DISCONNECT;\n                _this.emit({\n                    status: _this.currentStatus,\n                    message: event.message,\n                });\n            };\n            _this.currentStatus = STATUS.CONNECTING;\n            _this.emit({\n                status: _this.currentStatus,\n                message: _this.message,\n            });\n        };\n        this.send = function (message) {\n            if (message === undefined) {\n                return ErrorCode_1.default.CONNECTION_NOT_ESTABLISHED;\n            }\n            if (!_this.isTriggered) {\n                _this.isTriggered = true;\n                _this.connect();\n                return ErrorCode_1.default.CONNECTION_NOT_ESTABLISHED;\n            }\n            if (_this.websocketClient === undefined) {\n                return ErrorCode_1.default.CONNECTION_NOT_ESTABLISHED;\n            }\n            if (_this.currentStatus !== STATUS.CONNECTED) {\n                return ErrorCode_1.default.CONNECTION_NOT_ESTABLISHED;\n            }\n            try {\n                _this.websocketClient.send(message);\n                return ErrorCode_1.default.SUCCESS;\n            }\n            catch (e) {\n                // sending failed\n                return ErrorCode_1.default.FAILED_TO_SEND_MESSAGE;\n            }\n        };\n        this.appName = appName;\n        this.appId = appId;\n        this.message = {};\n        this.retryConnectTime = retryConnectTime;\n        console.log(url);\n        this.url = url;\n        console.log(this.url);\n        this.currentStatus = STATUS.DISCONNECT;\n    }\n    return PlayerSocket;\n}());\nexports["default"] = PlayerSocket;\n\n\n//# sourceURL=webpack://tactJs/./src/PlayerSocket.ts?')},"./src/index.ts":function(__unused_webpack_module,exports,__webpack_require__){eval('\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { "default": mod };\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.BhapticsPlayer = exports.ErrorCode = exports.PositionType = void 0;\nvar BhapticsPlayer_1 = __importDefault(__webpack_require__(/*! ./BhapticsPlayer */ "./src/BhapticsPlayer.ts"));\nexports.BhapticsPlayer = BhapticsPlayer_1.default;\nvar ErrorCode_1 = __importDefault(__webpack_require__(/*! ./models/ErrorCode */ "./src/models/ErrorCode.ts"));\nexports.ErrorCode = ErrorCode_1.default;\nvar Interfaces_1 = __webpack_require__(/*! ./models/Interfaces */ "./src/models/Interfaces.ts");\nObject.defineProperty(exports, "PositionType", ({ enumerable: true, get: function () { return Interfaces_1.PositionType; } }));\nexports["default"] = new BhapticsPlayer_1.default();\n\n\n//# sourceURL=webpack://tactJs/./src/index.ts?')},"./src/models/ErrorCode.ts":(__unused_webpack_module,exports)=>{eval('\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.ErrorCode = void 0;\nvar ErrorCode;\n(function (ErrorCode) {\n    ErrorCode[ErrorCode["SUCCESS"] = 0] = "SUCCESS";\n    ErrorCode[ErrorCode["MESSAGE_NOT_DEFINED"] = 1] = "MESSAGE_NOT_DEFINED";\n    ErrorCode[ErrorCode["CONNECTION_NOT_ESTABLISHED"] = 2] = "CONNECTION_NOT_ESTABLISHED";\n    ErrorCode[ErrorCode["FAILED_TO_SEND_MESSAGE"] = 3] = "FAILED_TO_SEND_MESSAGE";\n    ErrorCode[ErrorCode["MESSAGE_INVALID"] = 4] = "MESSAGE_INVALID";\n    ErrorCode[ErrorCode["MESSAGE_INVALID_DURATION_MILLIS"] = 5] = "MESSAGE_INVALID_DURATION_MILLIS";\n    ErrorCode[ErrorCode["MESSAGE_INVALID_DOT_INDEX_HEAD"] = 6] = "MESSAGE_INVALID_DOT_INDEX_HEAD";\n    ErrorCode[ErrorCode["MESSAGE_INVALID_DOT_INDEX_ARM"] = 7] = "MESSAGE_INVALID_DOT_INDEX_ARM";\n    ErrorCode[ErrorCode["MESSAGE_INVALID_DOT_INDEX_VEST"] = 8] = "MESSAGE_INVALID_DOT_INDEX_VEST";\n    ErrorCode[ErrorCode["MESSAGE_INVALID_INTENSITY"] = 9] = "MESSAGE_INVALID_INTENSITY";\n    ErrorCode[ErrorCode["MESSAGE_INVALID_X"] = 10] = "MESSAGE_INVALID_X";\n    ErrorCode[ErrorCode["MESSAGE_INVALID_Y"] = 11] = "MESSAGE_INVALID_Y";\n    ErrorCode[ErrorCode["MESSAGE_INVALID_ROTATION_X"] = 12] = "MESSAGE_INVALID_ROTATION_X";\n    ErrorCode[ErrorCode["MESSAGE_INVALID_ROTATION_Y"] = 13] = "MESSAGE_INVALID_ROTATION_Y";\n    ErrorCode[ErrorCode["MESSAGE_INVALID_SCALE_INTENSITY_RATIO"] = 14] = "MESSAGE_INVALID_SCALE_INTENSITY_RATIO";\n    ErrorCode[ErrorCode["MESSAGE_INVALID_SCALE_DURATION_RATIO"] = 15] = "MESSAGE_INVALID_SCALE_DURATION_RATIO";\n    ErrorCode[ErrorCode["MESSAGE_NOT_REGISTERED_KEY"] = 16] = "MESSAGE_NOT_REGISTERED_KEY";\n    ErrorCode[ErrorCode["MESSAGE_NOT_INITIALIZED"] = 17] = "MESSAGE_NOT_INITIALIZED";\n})(ErrorCode || (exports.ErrorCode = ErrorCode = {}));\nexports["default"] = ErrorCode;\n\n\n//# sourceURL=webpack://tactJs/./src/models/ErrorCode.ts?')},"./src/models/Interfaces.ts":(__unused_webpack_module,exports)=>{eval('\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.PositionType = void 0;\nvar PositionType;\n(function (PositionType) {\n    PositionType["VestFront"] = "VestFront";\n    PositionType["VestBack"] = "VestBack";\n    PositionType["Head"] = "Head";\n    PositionType["ForearmL"] = "ForearmL";\n    PositionType["ForearmR"] = "ForearmR";\n    PositionType["GloveL"] = "GloveL";\n    PositionType["GloveR"] = "GloveR";\n})(PositionType || (exports.PositionType = PositionType = {}));\n\n\n//# sourceURL=webpack://tactJs/./src/models/Interfaces.ts?')}},__webpack_module_cache__={};function __nested_webpack_require_21018__(e){var n=__webpack_module_cache__[e];if(void 0!==n)return n.exports;var t=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(t.exports,t,t.exports,__nested_webpack_require_21018__),t.exports}var __nested_webpack_exports__=__nested_webpack_require_21018__("./src/index.ts");return __nested_webpack_exports__})(),module.exports=factory()}},__webpack_module_cache__={};function __webpack_require__(e){var n=__webpack_module_cache__[e];if(void 0!==n)return n.exports;var t=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(t.exports,t,t.exports,__webpack_require__),t.exports}__webpack_require__(237);var __webpack_exports__=__webpack_require__(301);return __webpack_exports__})()));